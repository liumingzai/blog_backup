---
title: WEB攻击
date: 2019-07-11 09:33:47
tags:
 - XSS
 - SQL注入
 - 安全漏洞
---

## HTTP不具备必要的安全功能
> http协议不同于SSH协议，就是一个通用的单纯协议机制，没有级别认证和会话管理，导致web应用被攻击者变更篡改。常见的web应用攻击通过URL查询字段活表单，http首部，cookie等途径注入攻击代码。

![Web攻击](/assets/img/attack.png) 


## 针对Web应用的攻击模式
+ 以服务器为目标的主动攻击active attack（sql注入及os命令注入）
+ 以服务器为目标的被动攻击passive attack（跨站脚本攻击及跨站点请求伪造）

### 实施web应用安全对策(双重验证)
+ 客户端验证
+ 服务器端验证（输入值验证，输出值转义）

![Web攻击](/assets/img/verify.png) 
 

## 跨站脚本攻击（XSS)
> 跨站脚本攻击（Cross-Site Scriping）是指通过存在安全漏洞的web网站注册用户的浏览器内运行非法的html标签或者javascript脚本的一致攻击。动态生成的html存在安全漏洞隐患

+ 存储型XSS：存储型XSS，持久化，代码是存储在服务器中的，如在个人信息或发表文章等地方，插入代码，如果没有过滤或过滤不严，那么这些代码将储存到服务器中，用户访问该页面的时候触发代码执行。这种XSS比较危险，容易造成蠕虫，盗窃cookie
+ 反射型XSS：非持久化，需要欺骗用户自己去点击链接才能触发XSS代码（服务器中没有这样的页面和内容），一般容易出现在搜索页面。反射型XSS大多数是用来盗取用户的Cookie信息。
+ DOM型XSS：不经过后端，DOM-XSS漏洞是基于文档对象模型(Document Objeet Model,DOM)的一种漏洞，DOM-XSS是通过url传入参数去控制触发的，其实也属于反射型XSS。 DOM的详解：DOM文档对象模型

![存储型](/assets/img/XSS1.png) ![反射型](/assets/img/XSS2.png) ![XSS危害](/assets/img/XSS.png)

> XSS防御对用户表单输入（url参数）进行过滤，对输出进行html编码。过滤掉脚本执行，对动态输出页面的内容进行html编码，使脚本转成html实体无法执行

## SQL注入攻击
> sql 注入Injection是针对web应用使用的数据库，通过运行非法的sql而产生的的攻击。该安全隐患极大，直接导致数据机密泄露。

 - 非法查看或篡改数据库内数据
 - 规避认证
 - 执行和数据库服务器业务关联的程序

 ## OS注入攻击
 > OS命令注入攻击（OS Command Injection）是通过Web应用，执行非法的操作系统命令达到攻击目的，只要能调用shell的地方都存在攻击风险。通过管道符接收用户输入，并输出到指定文件
 
``` bash
my $adr = $q->param('mailaddress');
open(MAIL, "| /usr/sbin/sendmail $adr");
print MAIL "From: info@example.com\n";
``` 

 ## HTTP首部注入攻击
 > HTTP首部注入攻击（HTTP Header Injection）是指通过在响应首部字段内插入换行%0D%0A，添加任意响应首部或者主体的攻击。称之为HTTP响应截断攻击（HTTP Response Splitting Attack)。会造成的如下影响：

    1. 设置任何Cookie信息
    2. 重定向任意URL
    3. 显示任意的主体（HTTP响应截断攻击）

    HTTP 首部注入攻击示例：
    请求地址URL:101%0D%0ASet-Cookie:+SID=123456789
    Location: http://example.com/?cat=101(%0D%0A :换行符)
    Set-Cookie: SID=123456789

## HTTP响应截断攻击
> HTTP响应截断攻击是用在HTTP首部注入的一种，顺序相同，但是要将两个%0D%0A%0D%0A并排插入字符串后发送，利用这两个连续的换行可以做出HTTP首部和主题分隔所需的空行。这样就伪造了主题，达到攻击目的。

```bash
Set-Cookie: SID=123456789 (%0D%0A :换行符)
(%0D%0A :换行符)
<html><head><title>
 ......
```
利用这种攻击，通过伪造web页面，让用户输入自己信息，达到和跨站点脚本攻击相同效果。另外滥用HTTP/1.1中汇集多响应返回功能，会导致缓存服务器对任意内容进行缓存，称之为缓存污染，使用该缓存服务器的用户，在浏览遭受攻击的网站时，会不断第浏览被替换掉的web页面

## 邮件首部注入攻击
>邮件首部注入(Mail Header Injection)是指 Web 应用中的邮件发送功能,攻击者通过向邮件首部 To 或 Subject 内任意添加非法内容发起的攻击。利用存在安全漏洞的 Web 网站,可对任意邮件地址发送广告邮件或病毒邮件。

攻击者将以下数据作为邮件地址发起请求。
bob@hackr.jp%0D%0ABcc: user@example.com
%0D%0A 在邮件报文中代表换行符。一旦咨询表单所在的 Web应用接收了这个换行符,就可能实现对 Bcc 邮件地址的追加发送,而这原本是无法指定的。
另外像下面一样,使用两个连续的换行符就有可能篡改邮件文本内容并发送。
bob@hackr.jp%0D%0A%0D%0ATest Message
再以相同的方法,就有可能改写 To 和 Subject 等任意邮件首部,或向文本添加附件等动作。

## 目录遍历攻击
> 目录遍历(Directory Traversal)攻击是指对本无意公开的文件目录,通过非法截断其目录路径后,达成访问目的的一种攻击。这种攻击有时也称为路径遍历(Path Traversal)攻击。


通过 Web 应用对文件处理操作时,在由外部指定文件名的处理存在疏漏的情况下,用户可使用 .../ 等相对路径定位到 /etc/passed 等绝对路径上,因此服务器上任意的文件或文件目录皆有可能被访问到。

下面以显示读取文件功能为例,讲解目录遍历攻击。该功能通过以下查询字段,指定某个文件名。然后从 /www/log/ 文件目录下读取这个指定的文件。
http://example.com/read.php?log=0401.log
攻击者设置如下查询字段后发出请求。
http://example.com/read.php?log=../../etc/passwd
查询字段为了读取攻击者盯上的 /etc/passwd 文件,会从/www/log/ 目录开始定位相对路径。如果这份 read.php 脚本接受对指定目录的访问请求处理,那原本不公开的文件就存在可被访问的风险。

## 不正确的错误消息处理
> 不正确的错误消息处理(Error Handling Vulnerability)的安全漏洞是指,Web 应用的错误信息内包含对攻击者有用的信息。


**Web 应用抛出的错误消息**


Web 应用不必在用户的浏览画面上展现详细的错误消息。对攻击者来说,详细的错误消息有可能给他们下一次攻击以提示。为了不让错误消息给攻击者以启发,建议将提示消息的内容仅保留到“认证错误”这种程度即可。

**数据库等系统抛出的错误消息**

攻击者从消息中可读出数据库选用的是 MySQL,甚至还看见了 SQL 语句的片段。这可能给攻击者进行 SQL 注入攻击以启发。
系统抛出的错误主要集中在以下几个方面:
- PHP 或 ASP 等脚本错误
- 数据库或中间件的错误
- Web 服务器的错误

## 开放重定向
> 开放重定向(Open Redirect)是一种对指定的任意 URL 作重定向跳转的功能。而于此功能相关联的安全漏洞是指,假如指定的重定向 URL到某个具有恶意的 Web 网站,那么用户就会被诱导至那个 Web 网站。

该功能就是向 URL 指定参数后,使本来的 URL 发生重定向跳转。

http://example.com/?redirect=http://www.tricorder.jp

*会话劫持*
*会话固定攻击*
*跨站点伪造*



## 密码破解
>密码破解攻击(Password Cracking)即算出密码,突破认证。攻击不仅限于 Web 应用,还包括其他的系统(如 FTP 或 SSH 等)


密码破解有以下两种手段:
+ 通过网络的密码试错 (穷举法、字典法、利用别处泄露ID-密码)
+ 对已加密密码的破解(指攻击者入侵系统,已获得加密或散列处理的密码数据的情况)


除去突破认证的攻击手段,还有 SQL 注入攻击逃避认证,跨站脚本攻击窃取密码信息等方法。


## 点击劫持

> 点击劫持(Clickjacking)是指利用透明的按钮或链接做成陷阱,覆盖在 Web 页面之上。然后诱使用户在不知情的情况下,点击那个链接访问内容的一种攻击手段。这种行为又称为界面伪装(UIRedressing)。

iframe 页面中使用透明可点击按钮的示例
``` bash
<iframe id="target" src="http://sns.example.jp/leave" style="opaci
<button style="position:absolute;top:100;left:100;z-index:-1">PLAY
``` 

## DoS 攻击

> DoS 攻击(Denial of Service attack)是一种让运行中的服务呈停止状态的攻击。有时也叫做服务停止攻击或拒绝服务攻击。DoS 攻击的对象不仅限于 Web 网站,还包括网络设备及服务器等。
主要有以下两种 DoS 攻击方式:
集中利用访问请求造成资源过载,资源用尽的同时,实际上服务也就呈停止状态。
通过攻击安全漏洞使服务停止。

多台计算机发起的 DoS 攻击称为 DDoS 攻击(Distributed Denial ofService attack)。DDoS 攻击通常利用那些感染病毒的计算机作为攻击者的攻击跳板。

## 后门程序

> 后门程序(Backdoor)是指开发设置的隐藏入口,可不按正常步骤使用受限功能。利用后门程序就能够使用原本受限制的功能。

通常的后门程序分为以下 3 种类型:
* 开发阶段作为 Debug 调用的后门程序
* 开发者为了自身利益植入的后门程序
* 攻击者通过某种方法设置的后门程序

来源：[图解HTTP图书] 